<Window x:Class="Tum4ik.JustClipboardManager.Views.PasteWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:Tum4ik.JustClipboardManager.ViewModels" 
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors" 
        xmlns:controls="clr-namespace:Tum4ik.JustClipboardManager.Controls" 
        xmlns:converters="clr-namespace:Tum4ik.JustClipboardManager.Converters" 
        xmlns:const="clr-namespace:Tum4ik.JustClipboardManager.Constants" 
        xmlns:icons="clr-namespace:Tum4ik.JustClipboardManager.Icons;assembly=Tum4ik.JustClipboardManager.Icons"
        d:DataContext="{d:DesignInstance vm:PasteWindowViewModel}"
        mc:Ignorable="d"
        UseLayoutRounding="True"
        IsVisibleChanged="This_IsVisibleChanged"
        ShowInTaskbar="False"
        WindowStyle="None"
        Background="Transparent"
        AllowsTransparency="True"
        SizeToContent="WidthAndHeight"
        WindowStartupLocation="Manual"
        x:Name="This">
  <Window.Resources>
    <converters:BytesToStringConverter x:Key="BytesToStringConverter"/>
    <converters:BytesToImageSourceConverter x:Key="BytesToImageSourceConverter"/>
    <converters:BytesToFilesListConverter x:Key="BytesToFilesListConverter"/>

    <controls:ClipTypeDataTemplateSelector x:Key="ClipTypeDataTemplateSelector"/>
  </Window.Resources>
  <i:Interaction.Triggers>
    <i:PropertyChangedTrigger Binding="{Binding Visibility, ElementName=This}">
      <i:InvokeCommandAction Command="{Binding WindowVisibilityChangedCommand}"
                             CommandParameter="{Binding Visibility, ElementName=This}"/>
    </i:PropertyChangedTrigger>
    <i:EventTrigger EventName="Deactivated">
      <i:InvokeCommandAction Command="{Binding WindowDeactivatedCommand}"/>
    </i:EventTrigger>
  </i:Interaction.Triggers>
  <Border Width="300"
          MaxHeight="300"
          CornerRadius="4"
          BorderThickness="1"
          BorderBrush="{DynamicResource PasteWindowBorderBrush}"
          Background="{DynamicResource PasteWindowBackgroundBrush}"
          Margin="8"
          Padding="8"
          Effect="{StaticResource DefaultDropShadowEffect}">
    <DockPanel>
      <Grid DockPanel.Dock="Top">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto"/>
          <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <TextBlock Grid.Column="0" Text="Search" Margin="0, 0, 8, 0" VerticalAlignment="Center"/>
        <TextBox Grid.Column="1" 
                 Text="{Binding Search, UpdateSourceTrigger=PropertyChanged, Delay=1000}"
                 VerticalContentAlignment="Center"
                 Height="24"/>
      </Grid>
      <ListBox x:Name="_listBox" Margin="0, 8, 0, 0"
               ItemsSource="{Binding Clips}"
               ItemTemplateSelector="{StaticResource ClipTypeDataTemplateSelector}"
               ScrollViewer.ScrollChanged="ListBox_ScrollChanged"
               ScrollViewer.CanContentScroll="False"
               ScrollViewer.HorizontalScrollBarVisibility="Disabled">
        <i:Interaction.Triggers>
          <i:EventTrigger EventName="SelectionChanged">
            <i:InvokeCommandAction Command="{Binding PasteDataCommand}" 
                                   CommandParameter="{Binding SelectedItem, RelativeSource={RelativeSource AncestorType=ListBox}}"/>
          </i:EventTrigger>
        </i:Interaction.Triggers>
        <ListBox.Resources>
          <Style TargetType="ListBoxItem" BasedOn="{StaticResource {x:Type ListBoxItem}}">
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
          </Style>

          <DataTemplate x:Key="{x:Static const:DataTemplateNames.ClipTypeUndefined}">
            <TextBlock Text="????"/>
          </DataTemplate>
          <DataTemplate x:Key="{x:Static const:DataTemplateNames.ClipTypeText}">
            <Border Height="24" ToolTip="{Binding RepresentationData, Converter={StaticResource BytesToStringConverter}}">
              <TextBlock Text="{Binding ToolTip, RelativeSource={RelativeSource AncestorType=Border}}"
                         Margin="0, 4, 0, 4"/>
            </Border>
          </DataTemplate>
          <DataTemplate x:Key="{x:Static const:DataTemplateNames.ClipTypeImage}">
            <Image Source="{Binding RepresentationData, Converter={StaticResource BytesToImageSourceConverter}}"
                   HorizontalAlignment="Left"
                   Height="48"
                   Stretch="Uniform"/>
          </DataTemplate>
          <DataTemplate x:Key="{x:Static const:DataTemplateNames.ClipTypeSingleFile}">
            <Grid Height="24"
                  ToolTip="{Binding RepresentationData, Converter={StaticResource BytesToStringConverter}}">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="24"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition/>
              </Grid.ColumnDefinitions>
              <icons:SvgIcon Grid.Column="0" Icon="File" Width="14"  />
              <TextBlock Grid.Column="1" Text="..." Margin="4, 0, 0, 0"
                         VerticalAlignment="Center"/>
              <TextBlock Grid.Column="2" 
                         Text="{Binding ToolTip, RelativeSource={RelativeSource AncestorType=Grid}}"
                         HorizontalAlignment="Right"
                         VerticalAlignment="Center"/>
            </Grid>
          </DataTemplate>
          <DataTemplate x:Key="{x:Static const:DataTemplateNames.ClipTypeFilesList}">
            <Grid Height="24" 
                  ToolTip="{Binding RepresentationData, Converter={StaticResource BytesToFilesListConverter}}">
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="24"/>
                <ColumnDefinition/>
              </Grid.ColumnDefinitions>
              <icons:SvgIcon Grid.Column="0" Icon="Files" />
              <TextBlock Grid.Column="1" Text="Files List" Margin="4, 0" 
                         VerticalAlignment="Center"/>
            </Grid>
          </DataTemplate>
        </ListBox.Resources>
      </ListBox>
    </DockPanel>
  </Border>
</Window>
